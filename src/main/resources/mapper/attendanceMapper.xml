<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mcp.crispy.attendance.mapper.AttendanceMapper">

	<resultMap type="AttendanceDto" id="AttendanceMap">
		<id property="attNo" column="ATT_NO" />
		<result property="attInDt" column="ATT_IN_DT"/>
		<result property="attOutDt" column="ATT_OUT_DT"/>
		<result property="attWorkTime" column="ATT_WORK_TIME"/>
		<result property="createDt" column="CREATE_DT"/>
		<result property="creator" column="CREATOR"/>
		<result property="modifyDt" column="MODIFY_DT"/>
		<result property="modifier" column="MODIFIER"/>
		<association property="employee" javaType="EmployeeDto">
			<id property="empNo" column="EMP_NO" />
			<result property="empName" column="EMP_NAME" />
		</association>
	</resultMap>
	
<insert id="insertAttendance" parameterType="AttendanceDto">
    INSERT INTO ATTENDANCE_T (
        ATT_NO,
        ATT_IN_DT,
        ATT_OUT_DT,
        ATT_WORK_TIME,
        CREATE_DT,
        CREATOR,
        MODIFY_DT,
        MODIFIER,
        EMP_NO
    ) VALUES (
        ATTENDANCE_SEQ.NEXTVAL,
       	#{attInDt},
        #{attOutDt},
        #{attWorkTime},
        CURRENT_DATE,
        #{creator},
        CURRENT_DATE,
        #{modifier},
        #{empNo}
    )
</insert>

<select id="getAttList"
		resultMap="AttendanceMap">
SELECT * FROM
	(SELECT ROW_NUMBER() OVER(ORDER BY A.ATT_IN_DT ASC) AS RN 
		 , A.ATT_NO
		 , A.ATT_IN_DT
		 , A.ATT_OUT_DT
		 , A.ATT_WORK_TIME
		 , A.EMP_NO
		 , A.BOARD_NO
		 , U.USER_NAME
	  FROM ATTENDANCE_T A 
  	INNER JOIN EMPLOYEE_T E
	  ON A.EMP_NO = E.EMP_NO
 		WHERE A.ATT_NO = #{attNo})
</select>


</mapper>